var debug=!1,evolutionInterval=void 0,helper={getStorage:function(){return new Promise(function(e,t){chrome.storage.local.get("monster",function(o){debug&&console.log("getStorage ",o.monster),void 0!==o.monster?e(o.monster):t({hp:100,evolutionLevel:0,evolutionStage:0,evolutionTimestamp:0,monster:"",monsterStatus:"",tabCount:0})})})},setStorage:function(e){var t={monster:e};return debug&&console.log("tabagotchi setStorage",t),new Promise(function(e,o){try{chrome.storage.local.set(t,function(){e("local storage set")})}catch(e){o("local storage not set - error occurred.")}})},initialTabCount:function(){return new Promise(function(e,t){debug&&console.log("in initialTabCount"),chrome.tabs.query({},function(o){void 0===typeof o?(debug&&console.log("in initialTabCount reject"),t()):(debug&&console.log("in initialTabCount resolve",o.length),e(--o.length))})})},setStateText:function(e){var t=[],o=Math.floor(3*Math.random());100===e.hp?e.monsterStatus='"Yippee!"':e.hp<=99&&e.hp>=80?(t=['"Oh yeah!"','"So happy!"','"Hi! Hello! Hi!"'],e.monsterStatus=t[o]):e.hp<=79&&e.hp>=60?(t=['"You are the best!"','"Life is good!"','"<3"'],e.monsterStatus=t[o]):e.hp<=59&&e.hp>=40?(t=['"Hmph!"','"Too. Many. Tabs."','"Please close tabs."'],e.monsterStatus=t[o]):e.hp<=39&&e.hp>=20?(t=['"So mad at you!"','"%(*$&%&"','"Argh!"'],e.monsterStatus=t[o]):e.hp<=19&&e.hp>=1?(t=['"Feeling sick..."','"Slipping away..."','"Stomachache..."'],e.monsterStatus=t[o]):e.hp<=0&&(e.monsterStatus='"R.I.P."')},poop:function(e,t){var o=[e.poop.poop1,e.poop.poop2,e.poop.poop3,e.poop.poop4,e.poop.poop5,e.poop.poop6],s=[];o.forEach(function(e){e.style.display="none"}),t.evolutionLevel>0&&o.forEach(function(e){e.classList.add("color")}),t.hp<=59&&t.hp>=40?s=o.slice(0,1):t.hp<=39&&t.hp>=20?s=o.slice(0,3):t.hp<=19&&t.hp>=1&&(s=o),s.forEach(function(e){e.style.display="block"})},setRandomAsset:function(e,t){var o=Math.floor(3*Math.random()),s={state1:["../../assets/level-"+t.evolutionLevel+"/monster-state-1-v1.gif","../../assets/level-"+t.evolutionLevel+"/monster-state-1-v2.gif","../../assets/level-"+t.evolutionLevel+"/monster-state-1-v3.gif"],state2:["../../assets/level-"+t.evolutionLevel+"/monster-state-2-v1.gif","../../assets/level-"+t.evolutionLevel+"/monster-state-2-v2.gif","../../assets/level-"+t.evolutionLevel+"/monster-state-2-v3.gif"],state3:["../../assets/level-"+t.evolutionLevel+"/monster-state-3-v1.gif","../../assets/level-"+t.evolutionLevel+"/monster-state-3-v2.gif","../../assets/level-"+t.evolutionLevel+"/monster-state-3-v3.gif"],state4:["../../assets/level-"+t.evolutionLevel+"/monster-state-4-v1.gif","../../assets/level-"+t.evolutionLevel+"/monster-state-4-v2.gif","../../assets/level-"+t.evolutionLevel+"/monster-state-4-v3.gif"],state5:["../../assets/level-"+t.evolutionLevel+"/monster-state-5-v1.gif","../../assets/level-"+t.evolutionLevel+"/monster-state-5-v2.gif","../../assets/level-"+t.evolutionLevel+"/monster-state-5-v3.gif"],state6:["../../assets/level-"+t.evolutionLevel+"/monster-state-6-v1.gif","../../assets/level-"+t.evolutionLevel+"/monster-state-6-v1.gif","../../assets/level-"+t.evolutionLevel+"/monster-state-6-v1.gif"]};100===t.hp?e.monster.src=s.state1[o]:t.hp<=99&&t.hp>=80?e.monster.src=s.state1[o]:t.hp<=79&&t.hp>=60?e.monster.src=s.state2[o]:t.hp<=59&&t.hp>=40?e.monster.src=s.state3[o]:t.hp<=39&&t.hp>=20?e.monster.src=s.state4[o]:t.hp<=19&&t.hp>=1?e.monster.src=s.state5[o]:t.hp<=0&&(e.monster.src=s.state6[o])},handleEvolutionTimer:function(e,t){var o=Date.now(),s=o-t.evolutionTimestamp>=36e5,l=e.evolutionUISegments;if(debug&&console.log(o,t.evolutionTimestamp,s,typeof evolutionInterval),t.tabCount>5){debug&&console.log("cannot start evolution timer, too many tabs");for(var n=0;n<l.length;n++)l[n].classList.remove("toggle");helper.clearEvolutionTimer()}else t.tabCount<6&&void 0===evolutionInterval&&s&&(evolutionInterval=setInterval(function(){t.evolutionStage<10&&t.evolutionLevel<2?(t.evolutionStage++,t.evolutionTimestamp=Date.now()):10===t.evolutionStage&&t.evolutionLevel<2?(t.evolutionStage=0,t.evolutionLevel++,t.evolutionTimestamp=Date.now()):2===t.evolutionLevel&&(t.evolutionStage=10),helper.updateEvolutionUI(e,t),debug&&console.log("evolution timer started",evolutionInterval,t)},36e5))},updateEvolutionUI:function(e,t){var o=t.evolutionLevel,s=t.evolutionStage,l=e.evolutionUISegments;if(0===s&&o<2){for(var n=0;n<l.length;n++)l[n].classList.remove("on"),l[n].classList.remove("toggle"),l[n].classList.add("off");l[0].classList.add("toggle")}else{for(var a=0;a<s;a++)l[a].classList.remove("off"),l[a].classList.remove("toggle"),l[a].classList.add("on");if(s<10&&l[s].classList.add("toggle"),debug&&console.log("evolution stage is "+t.evolutionStage),10===s&&o<2)for(var i=0;i<l.length;i++)l[i].classList.add("toggle")}e.evolutionSilhouettes.classList.remove("level-0"),e.evolutionSilhouettes.classList.remove("level-1"),e.evolutionSilhouettes.classList.add("level-"+t.evolutionLevel),helper.setUI(e,t),helper.setStorage(t).then(function(e){debug&&console.log(e)}).catch(function(e){debug&&console.log(e)})},setEvolutionGif:function(e,t){var o=e.monster;0===t.evolutionLevel?o.src="../../assets/evolution/level-1-evolution.gif":1===t.evolutionLevel&&(o.src="../../assets/evolution/level-2-evolution.gif")},clearEvolutionTimer:function(){clearInterval(evolutionInterval),evolutionInterval=void 0},setUI:function(e,t){var o=t.hp<=0?0:t.hp;debug&&console.log("setUI",t),e.evolutionState.innerText=t.evolutionStage+"/10",e.hpProgressBar.style.width=o+"%",e.hpState.innerText=o+"/100",e.monsterStatus.innerText=""+t.monsterStatus,e.tabCount.innerText="You have "+t.tabCount+" tabs open",helper.setStateText(t),helper.setRandomAsset(e,t),helper.poop(e,t),helper.setStorage(t).then(function(e){debug&&console.log(e)}).catch(function(e){debug&&console.log(e)})}};
document.addEventListener("DOMContentLoaded",function(){var e,t={body:document.getElementById("tabagotchi"),preloader:document.getElementById("preloader-container"),evolutionState:document.getElementById("evolution-state"),evolutionUISegments:document.querySelectorAll(".evolution-segment"),evolutionSilhouettes:document.getElementById("evolution-silhouettes"),hpProgressBar:document.getElementById("hp-indicator"),hpState:document.getElementById("hp-indicator-text"),poop:{poop1:document.getElementById("poop-1"),poop2:document.getElementById("poop-2"),poop3:document.getElementById("poop-3"),poop4:document.getElementById("poop-4"),poop5:document.getElementById("poop-5"),poop6:document.getElementById("poop-6")},monster:document.querySelector("#monster a img"),monsterStatus:document.getElementById("monster-text"),tabCount:document.getElementById("tab-count"),tips:document.querySelectorAll(".tip"),tipModals:{evolution:document.getElementById("evolution-tip"),health:document.getElementById("health-tip"),monster:document.getElementById("monster-tip")}};helper.getStorage().then(function(t){e=t}).catch(function(t){e=t}).then(function(){helper.initialTabCount().then(function(o){e.tabCount=o,e.hp=100-4*e.tabCount,helper.updateEvolutionUI(t,e),helper.handleEvolutionTimer(t,e),helper.setUI(t,e),t.preloader.style.display="none"}).catch(function(o){helper.handleEvolutionTimer(t,e),helper.setUI(t,e),t.preloader.style.display="none"})}),chrome.tabs.onCreated.addListener(function(){++e.tabCount,e.hp=100-4*e.tabCount,helper.updateEvolutionUI(t,e),helper.handleEvolutionTimer(t,e),helper.setUI(t,e)}),chrome.tabs.onRemoved.addListener(function(){--e.tabCount,e.hp=100-4*e.tabCount,helper.updateEvolutionUI(t,e),helper.handleEvolutionTimer(t,e),helper.setUI(t,e)}),t.monster.addEventListener("click",function(e){e.preventDefault(),t.monster.style.marginTop="-50px",setTimeout(function(){t.monster.style.marginTop="0px"},250)}),t.tips.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault()}),e.addEventListener("mouseenter",function(e){e.preventDefault();var o=e.currentTarget;o.classList.contains("transition")||(o.classList.contains("evolution")?t.tipModals.evolution.style.display="block":o.classList.contains("health")?t.tipModals.health.style.display="block":t.tipModals.monster.style.display="block",o.classList.add("transition"))}),e.addEventListener("mouseleave",function(e){e.preventDefault();var o=e.currentTarget;o.classList.contains("evolution")?t.tipModals.evolution.style.display="none":o.classList.contains("health")?t.tipModals.health.style.display="none":t.tipModals.monster.style.display="none",o.classList.remove("transition")})})});